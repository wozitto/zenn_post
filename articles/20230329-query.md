---
title: "testing libraryã§ã®getBy, queryBy, findByã®é•ã„ã«ã¤ã„ã¦"
emoji: "ğŸ”‘"
type: "tech"
topics: []
published: false
---

## getBy, queryBy, findByã®é•ã„

[Testing Library](https://testing-library.com/) ã«ã¯ä»¥ä¸‹ï¼“ç¨®é¡ã®queryãŒã‚ã‚Šã¾ã™ã€‚
é–‹ç™ºã«ãŠã„ã¦ã€ãŸã³ãŸã³queryã®ä½¿ã„åˆ†ã‘ã§æ··ä¹±ã—ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã£ãŸã®ã§ã€æ•´ç†ã‚’ã“ã‚ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

- getBy
- queryBy
- findBy

ãã‚Œãã‚Œå®Ÿè£…ä¾‹ã¨å…±ã«èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

#### [getBy*](https://testing-library.com/docs/queries/about/#types-of-queries:~:text=Single%20Elements-,getBy...,-%3A%20Returns%20the%20matching)
> æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã«ä¸€è‡´ã™ã‚‹å˜ä¸€ã®è¦ç´ ã‚’è¿”ã—ã¾ã™ã€‚æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã€ã¾ãŸã¯è¤‡æ•°ã®ãƒãƒƒãƒãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã•ã‚Œã¾ã™ã€‚
> åŒã˜æ¡ä»¶ã§è¤‡æ•°ã®è¦ç´ ã‚’ç¢ºèªã™ã‚‹å ´åˆã¯ã€ä»£ã‚ã‚Šã«getAllByã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

getByã¯ç‰¹å®šã®æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ã‚’**å–å¾—**ã™ã‚‹ãŸã‚ã«æœ‰ç”¨ã§ã™ã€‚

å®Ÿè£…ä¾‹

```ts
import { render, screen } from '@testing-library/react'

test('submitãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨', () => {
  render(<Submit />)
  const button = screen.getByRole('button', { name: 'submit' })
})
```

#### [queryBy*](https://testing-library.com/docs/queries/about/#types-of-queries:~:text=element%20is%20expected.-,queryBy...,-%3A%20Returns%20the%20matching)
> æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã«ä¸€è‡´ã™ã‚‹å˜ä¸€ã®è¦ç´ ã‚’è¿”ã—ã¾ã™ã€‚æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã¯ã€nullãŒè¿”ã•ã‚Œã¾ã™
> åŒã˜æ¡ä»¶ã§è¤‡æ•°ã®è¦ç´ ã‚’ç¢ºèªã™ã‚‹å ´åˆã¯ã€ä»£ã‚ã‚Šã«queryAllByã‚’ä½¿ç”¨ã—ã¾ã™ã€‚(queryAllByã¯æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã€ç©ºã®é…åˆ—ï¼ˆ[]ï¼‰ã‚’è¿”ã—ã¾ã™)

queryByã¯ç‰¹å®šã®è¦ç´ ãŒ**å­˜åœ¨ã—ãªã„ã“ã¨**ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«æœ‰ç”¨ã§ã™ã€‚

å®Ÿè£…ä¾‹

```ts
import { render, screen } from '@testing-library/react'

test('cancelãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã“ã¨', () => {
  render(<Submit />)
  expect(screen.queryByRole('button', { name: 'cancel' }).not.toBeInTheDocument();
})
```

#### [findBy*](https://testing-library.com/docs/queries/about/#types-of-queries:~:text=this%20is%20OK.-,findBy...,-%3A%20Returns%20a%20Promise)
> æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã«ä¸€è‡´ã™ã‚‹å˜ä¸€ã®è¦ç´ ã‚’è§£æ±ºã™ã‚‹Promiseã‚’è¿”ã—ã¾ã™ã€‚æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆã€ã¾ãŸã¯1000mså¾Œã«è¤‡æ•°ã®è¦ç´ ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã¾ã™ã€‚
> åŒã˜æ¡ä»¶ã§è¤‡æ•°ã®è¦ç´ ã‚’ç¢ºèªã™ã‚‹å ´åˆã¯ã€ä»£ã‚ã‚Šã«findAllByã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
> findByã¯getByã‚¯ã‚¨ãƒªã‚’waitForã§ãƒ©ãƒƒãƒ—ã—ãŸã‚¯ã‚¨ãƒªãƒ¼ã§ã™ã€‚

å®Ÿè£…ç®‡æ‰€: "https://github.com/testing-library/dom-testing-library/blob/eadf7485430968df8d1e1293535d78cdbeea20a5/src/query-helpers.ts#L246-L248"

findByã¯ç‰¹å®šã®æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ã‚’**éåŒæœŸã«å–å¾—**ã™ã‚‹ãŸã‚ã«æœ‰ç”¨ã§ã™ã€‚
ï¼ˆéåŒæœŸAPIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå¸°ã£ã¦ããŸå¾Œã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºã‚„ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå¾Œã®ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã®ç¢ºèªãªã©ï¼‰
ã¾ãŸfindByã¯Promiseã‚’è¿”ã™ãŸã‚async/awaitã‹then()ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å®Ÿè£…ä¾‹
éåŒæœŸAPIã®å‘¼ã³å‡ºã—å‰ã€å‘¼ã³å‡ºã—å¾Œã§å¤‰ã‚ã‚‹çŠ¶æ…‹ã®ç¢ºèª

```ts
import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { rest } from 'msw';
import { setupServer } from 'msw/node';
import MyComponent from './MyComponent';

const server = setupServer(
  rest.get('/api/data', (req, res, ctx) => {
    return res(ctx.json({ data: 'dummy data' }));
  })
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

test('ãƒœã‚¿ãƒ³ãŒAPIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾…æ©Ÿã—ã¦ã„ã‚‹é–“ã¯disableã«ãªã£ã¦ã„ã‚‹ã“ã¨', async () => {
  render(<MyComponent />);

  // ãƒœã‚¿ãƒ³ãŒdisableçŠ¶æ…‹ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
  const button = screen.getByRole('button', { name: 'Load Data' });
  expect(button).toBeDisabled();

  // ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
  userEvent.click(button);

  // APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾…æ©Ÿã™ã‚‹
  const dataElement = await screen.findByText('dummy data');

  // ãƒœã‚¿ãƒ³ãŒenableçŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
  expect(button).toBeEnabled();
});
```

### ã¾ã¨ã‚

**getBy**

- ç‰¹å®šã®æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«æœ‰ç”¨
- å­˜åœ¨ã—ãªã„è¦ç´ ã‚’å–å¾—ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹

**queryBy**

- ç‰¹å®šã®è¦ç´ ãŒå­˜åœ¨ã—ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«æœ‰ç”¨
- å­˜åœ¨ã—ãªã„è¦ç´ ã‚’å–å¾—ã—ã‚ˆã†ã¨ã™ã‚‹ã¨nullã‚’è¿”ã™

**findBy**

- ç‰¹å®šã®æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹è¦ç´ ã‚’éåŒæœŸã«å–å¾—ã™ã‚‹ãŸã‚ã«æœ‰ç”¨
- å­˜åœ¨ã—ãªã„è¦ç´ ã‚’å–å¾—ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
- Promiseã‚’è¿”ã™ãŸã‚async/awaitã‹then()ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

ref

- https://testing-library.com/docs/queries/about/
- https://github.com/testing-library/dom-testing-library
